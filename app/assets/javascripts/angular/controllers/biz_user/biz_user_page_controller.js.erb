app.controller('BizUserCtrl', ['$scope', '$http', '$auth', '$location', function($scope, $http, $auth, $location){
  
  var url = "<%= ENV['URL'] %>" || "http://localhost:3000";
  $scope.authuserid = $auth.validateUser().$$state.value.id //the id of the user
  $scope.addForm  = {};
  $scope.form     = {};
 
  $http.get(url + '/biz_users/' + $scope.authuserid + '/services').success(function(response){

    $scope.services = response;
  })

  $http.get(url + '/biz_users/' + $scope.authuserid + '/sessions').success(function(response){
    $scope.sessions = response;
  })

  $scope.form.create = function(){
    var data = $scope.addForm;
    $http.post(url + '/services', data).success(function(response){
     // console.log(response) 
    })
  }

  $scope.resolved = function(session){

    var data = {'is_completed?': true}

    $http.put(url + '/sessions/' + session.id, data).success(function(response){
      session.hide = true
    })

  }

  var clickedService = ""

  $scope.selectedService = function(service){
    // console.log(service.service_name)
    clickedService = service.service_name
  }
  
  $scope.selected = function(session, index, array){
    
      return session.service_name == clickedService
  }


// redirect functions

  $scope.redirectHistory = function(){
    $location.path('/biz_users/history');
  }

  $scope.redirectProfile = function(){
    $location.path('/biz_users/profile');
  }

  

}]);

